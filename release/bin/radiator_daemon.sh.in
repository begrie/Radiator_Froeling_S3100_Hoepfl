#!  /bin/bash

SCRIPT_HOME="$(dirname "$0")"
[ -e "$SCRIPT_HOME/radiator.conf" ] && source "$SCRIPT_HOME/radiator.conf"
[ -e "@sysconfdir@/radiator.conf" ] && source "@sysconfdir@/radiator.conf"
[ -e "$HOME/.radiatorrc" ] && source "$HOME/.radiatorrc"

if [ -z "$SERIAL_DEVICE" ] ; then
   exec >&2
   echo "\$HOME/.radiatorrc,"
   echo "@sysconfdir@/radiator.conf,"
   echo "or $SCRIPT_HOME/radiator.conf"
   echo
   echo "must set"
   echo
   echo "   SERIAL_DEVICE"
   echo
   echo "See @docdir@/radiator.conf for an example."
   echo
   exit 1
fi

"@bindir@/radiator" \
-o >(tee -a >("@bindir@/radiator_sql.sh" | mysql \
              >"@localstatedir@/log/radiator_sql.log" 2>&1) | \
     tee -a >("@bindir@/radiator_mailError.sh" \
              >"@localstatedir@/log/radiator_mailError.log" 2>&1) | \
     "@bindir@/radiator_rrdtool.sh" \
               >"@localstatedir@/log/radiator_rrdtool.log" 2>&1) \
"$SERIAL_DEVICE" \
   >"@localstatedir@/log/radiator.log" 2>&1 &

echo $! >"@localstatedir@/run/radiator.pid"
